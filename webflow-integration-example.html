<!DOCTYPE html>
<html>
<head>
  <title>Grid.js Integration Example</title>
  <!-- Include Grid.js CSS -->
  <link href="https://cdn.jsdelivr.net/npm/gridjs/dist/theme/mermaid.min.css" rel="stylesheet" />

  <!-- Atkinson Hyperlegible Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible:wght@400;700&display=swap" rel="stylesheet">

  <style>
    /* Apply Atkinson Hyperlegible font everywhere */
    * {
      font-family: 'Atkinson Hyperlegible', sans-serif !important;
    }

    #grid-wrapper {
      max-width: 1200px;
      margin: 0 auto;
    }

    /* NUCLEAR OPTION: Remove ALL backgrounds and borders from EVERYTHING */
    .gridjs-wrapper,
    .gridjs-head,
    .gridjs-container,
    .gridjs-footer,
    .gridjs-table,
    .gridjs table,
    .gridjs tbody,
    .gridjs thead,
    .gridjs tr,
    .gridjs-td,
    .gridjs-th,
    .gridjs th,
    .gridjs td {
      background: transparent !important;
      background-color: transparent !important;
      border: none !important;
      box-shadow: none !important;
      color: white !important;
    }

    /* Bold and larger first column */
    .gridjs-td:first-child {
      font-weight: bold !important;
      font-size: 1.2em !important;
    }

    /* Style for alt text under name */
    .sound-alt {
      font-size: 0.85em;
      opacity: 0.8;
      font-weight: normal;
      margin-top: 4px;
      display: block;
    }

    /* Search bar aligned with table */
    .gridjs-search {
      background: transparent !important;
      float: none !important;
    }

    .gridjs-search-input {
      width: 100% !important;
      max-width: 100% !important;
      box-sizing: border-box !important;
      background: rgba(255, 255, 255, 0.1) !important;
      color: white !important;
      border: 1px solid rgba(255, 255, 255, 0.3) !important;
    }

    .gridjs-search-input::placeholder {
      color: rgba(255, 255, 255, 0.6) !important;
    }

    /* Pagination styling - remove white backgrounds */
    .gridjs-pagination {
      background: transparent !important;
      color: white !important;
    }

    .gridjs-pages {
      background: transparent !important;
    }

    .gridjs-pages button {
      background: transparent !important;
      color: white !important;
      border: 1px solid rgba(255, 255, 255, 0.3) !important;
    }

    .gridjs-pages button:hover {
      background: rgba(255, 255, 255, 0.1) !important;
    }

    .gridjs-pages button[disabled] {
      opacity: 0.5 !important;
      background: transparent !important;
    }

    .gridjs-summary {
      color: white !important;
      background: transparent !important;
    }

    /* Links */
    .gridjs-td a {
      color: #6db9ff !important;
    }

    .gridjs-td a:hover {
      color: #9fd3ff !important;
    }

    /* Sort icons */
    .gridjs-sort {
      color: white !important;
    }
  </style>
</head>
<body>
  <div id="grid-wrapper"></div>

  <!-- Include Grid.js -->
  <script src="https://cdn.jsdelivr.net/npm/gridjs/dist/gridjs.umd.js"></script>

  <script>
    // Helper function to parse degree notation coordinates
    function parseDegreeCoordinates(location) {
      // Match format like: 40째26'44.4"N 80째00'26.5"W
      const coordRegex = /(\d+)째(\d+)'([\d.]+)"([NS])\s+(\d+)째(\d+)'([\d.]+)"([EW])/;
      const match = location.match(coordRegex);

      if (match) {
        // Parse latitude
        const latDeg = parseFloat(match[1]);
        const latMin = parseFloat(match[2]);
        const latSec = parseFloat(match[3]);
        const latDir = match[4];
        let lat = latDeg + (latMin / 60) + (latSec / 3600);
        if (latDir === 'S') lat = -lat;

        // Parse longitude
        const lngDeg = parseFloat(match[5]);
        const lngMin = parseFloat(match[6]);
        const lngSec = parseFloat(match[7]);
        const lngDir = match[8];
        let lng = lngDeg + (lngMin / 60) + (lngSec / 3600);
        if (lngDir === 'W') lng = -lng;

        return { lat, lng };
      }

      return null;
    }

    // Helper function to create map link
    function createMapLink(location) {
      if (!location || location.trim() === '') {
        return '';
      }

      // Try to parse degree notation
      const coords = parseDegreeCoordinates(location);

      if (coords) {
        // Use parsed coordinates
        const url = `https://www.google.com/maps?q=${coords.lat},${coords.lng}`;
        return gridjs.html(`<a href="${url}" target="_blank" rel="noopener">${location}</a>`);
      } else {
        // Use address search (Google Maps will geocode it)
        const url = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(location)}`;
        return gridjs.html(`<a href="${url}" target="_blank" rel="noopener">${location}</a>`);
      }
    }

    // Helper function to format name with context, display name, and alt text
    function formatName(context, displayName, alt) {
      let title = context || '';
      if (displayName && displayName.trim() !== '') {
        if (title) {
          title = `${title} - ${displayName}`;
        } else {
          title = displayName;
        }
      }

      if (alt && alt.trim() !== '') {
        return gridjs.html(`<div>${title}<span class="sound-alt">${alt}</span></div>`);
      }
      return title;
    }

    // Initialize Grid.js with server-side data
    new gridjs.Grid({
      columns: ['Sound', 'Location', 'Credit'],
      server: {
        url: 'https://immersion-credits.sam-1c2.workers.dev/',
        then: data => data
          .filter(card => card['Display Name'] && card['Display Name'].trim() !== '')
          .map(card => [
            formatName(card.Context, card['Display Name'], card['Alt']),
            createMapLink(card.Location),
            card['Credit/Institutions'] || ''
          ])
      },
      search: true,
      sort: false,
      pagination: {
        limit: 25
      },
      resizable: true,
      fixedHeader: true,
      style: {
        table: {
          'font-size': '14px',
          'background': 'transparent',
          'border': 'none'
        },
        th: {
          'background': 'transparent',
          'color': 'white',
          'border': 'none'
        },
        td: {
          'background': 'transparent',
          'color': 'white',
          'border': 'none'
        }
      }
    }).render(document.getElementById('grid-wrapper'));
  </script>
</body>
</html>
