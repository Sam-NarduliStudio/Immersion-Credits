<!DOCTYPE html>
<html>
<head>
  <title>Grid.js Integration Example</title>
  <!-- Include Grid.js CSS -->
  <link href="https://cdn.jsdelivr.net/npm/gridjs/dist/theme/mermaid.min.css" rel="stylesheet" />

  <style>
    #grid-wrapper {
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }

    /* Custom styling for grid.js - adjust as needed */
    .gridjs-wrapper {
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <div id="grid-wrapper"></div>

  <!-- Include Grid.js -->
  <script src="https://cdn.jsdelivr.net/npm/gridjs/dist/gridjs.umd.js"></script>

  <script>
    // Helper function to create map link from coordinates
    function createMapLink(location, coordinates) {
      if (!coordinates || coordinates.trim() === '') {
        return location || '';
      }

      // Parse coordinates (format: lat,lng,elevation)
      const coords = coordinates.split(',').map(c => c.trim());
      if (coords.length >= 2) {
        const lat = coords[0];
        const lng = coords[1];
        const url = `https://www.google.com/maps?q=${lat},${lng}`;
        return gridjs.html(`<a href="${url}" target="_blank" rel="noopener">${location || 'View Map'}</a>`);
      }

      return location || '';
    }

    // Initialize Grid.js with server-side data
    new gridjs.Grid({
      columns: ['Display Name', 'Location', 'Context', 'Credit'],
      server: {
        url: 'https://immersion-credits.sam-1c2.workers.dev/',
        then: data => data
          .filter(card => card['Display Name'] && card['Display Name'].trim() !== '')
          .map(card => [
            card['Display Name'],
            createMapLink(card.Location, card['3d_map_coordinates']),
            card.Context || '',
            card['Credit/Institutions'] || ''
          ])
      },
      search: true,
      sort: true,
      pagination: {
        limit: 25
      },
      resizable: true,
      fixedHeader: true,
      style: {
        table: {
          'font-size': '14px'
        }
      }
    }).render(document.getElementById('grid-wrapper'));
  </script>
</body>
</html>
